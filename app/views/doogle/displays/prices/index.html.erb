<%= render 'doogle/displays/submenu' %>

<%= will_paginate @prices %>

<% if @prices.size == 0 %>
<h2>No pricing! Create some!</h2>
<% else %>
<table class="data">
	<thead>
		<tr>
			<th>Approval</th>
			<th>Start Date</th>
			<th>Last Date</th>
			<th>Quantity</th>
			<th>Price</th>
			<th>Notes</th>
		</tr>
	</thead>
	<tbody>
		<% @prices.each do |p| %>
		<tr>
			<td><%= p.approval_status.name %></td>
			<td><%= p.start_date.to_s(:number_date) %></td>
			<td><%= p.last_date.try(:to_s, :number_date) %></td>
			<% level = p.levels_used.first %>
			<td><%= cm level.try(:quantity) %></td>
			<td><%= cm level.try(:price), :dollars %></td>
			<td rowspan="<%= p.levels_used.size %>"><%= simple_format p.notes %></td>
			<% if permitted_to? :manage, :doogle_display_prices %>
			<td>
				<%= link_to 'Edit', edit_doogle_display_price_url(@display, p) %>
			</td>
			<% end %>
		</tr>
			<% extra_levels = p.levels_used[1..-1] 
				 extra_levels.each do |level| %>
			<tr>
				<% if level == extra_levels.first %>
				<td colspan="3" rowspan="<%= extra_levels.size %>"></td>
				<% end %>
				<td><%= cm level.quantity %></td>
				<td><%= cm level.price, :dollars %></td>
			</tr>
			<% end %>
		<% end %>
	</tbody>
</table>
<% end %>
<p><%= link_to 'New Pricing', new_doogle_display_price_url(@display) %></p>
