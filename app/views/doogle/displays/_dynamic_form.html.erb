<% unless defined?(trigger_change) %>
<% trigger_change = false %>
<% end %>
<% content_for :javascripts do %>
<script type="text/javascript">
$(function() {
  $("select#<%= object_name %>_type_key").change(function(e) {
		var hide_fields = <%= Doogle::FieldConfig.main.map(&:key).to_json.html_safe %>;
		var fields_for = <%= Doogle::DisplayConfig.key_to_field_keys.to_json.html_safe %>;
		var display_type = $(this).children("option:selected").attr("value");
		for (var i = 0; i < hide_fields.length; i++) {
			// console.log("hiding li#<%= object_name %>_"+hide_fields[i]+"_input");
			$("li#<%= object_name %>_"+hide_fields[i]+"_input").hide().children('input, select').attr('disabled', true);
		}
		var show_fields = fields_for[display_type] || hide_fields;
    if (show_fields) {
			for (var i = 0; i < show_fields.length; i++) {
				// console.log("showing li#<%= object_name %>_"+show_fields[i]+"_input");
				$("li#<%= object_name %>_"+show_fields[i]+"_input").show().children('input, select').attr('disabled', false);;
			}
		}
  })<%= trigger_change ? ".trigger('change');" : '' %>
})
</script>
<% end %>